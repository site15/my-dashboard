# Документ контекста проекта для ИИ

Этот документ предоставляет исчерпывающий контекст для ИИ систем для понимания проекта "Мой Дашборд". Он включает цели проекта, архитектуру, технологический стек, текущий статус реализации и ссылки на подробную документацию.

## Обзор проекта

**Название проекта**: Мой Дашборд
**Описание**: Система управления дашбордами для отображения информации на старых Android-телефонах. Пользователи создают дашборды через веб-приложение, добавляют виджеты и привязывают телефоны через QR-код. Телефон получает данные через API и отображает виджеты в реальном времени.
**Демо**: https://site15-my-dashboard.vercel.app

## Структура проекта

Проект состоит из двух основных компонентов:

1. **Мобильное приложение** (`/mobile`)
   - Фреймворк: Ionic-Angular с Capacitor для поддержки Android
   - Система сборки: Ionic + Capacitor
   - Целевая платформа: Android
   - Навигация: На основе вкладок (tab1, tab2, tab3)

2. **Веб-приложение** (`/web`)
   - Фреймворк: AnalogJS (Angular-основанный фулстек фреймворк)
   - Бэкенд: Серверные маршруты в `/src/server`
   - База данных: Prisma ORM с PostgreSQL
   - API: tRPC для типобезопасной коммуникации
   - Развертывание: Vercel

## Технологический стек

### Веб-приложение
- **Фронтенд**: AnalogJS, Angular, tRPC клиент
- **Бэкенд**: Серверные маршруты AnalogJS, tRPC сервер
- **База данных**: Prisma ORM, PostgreSQL
- **Стилизация**: Pico.css, Tailwind CSS
- **Аутентификация**: OAuth Telegram
- **Развертывание**: Vercel

### Мобильное приложение
- **Фреймворк**: Ionic-Angular
- **Нативная интеграция**: Capacitor
- **UI компоненты**: Библиотека Ionic UI
- **Цель**: Android

### Общие технологии
- **Язык**: TypeScript
- **Инструмент сборки**: npm
- **Тестирование**: Vitest
- **База данных**: PostgreSQL (рекомендуется Neon)

## Схема базы данных

См. подробную схему в [schema.prisma](./web/prisma/schema.prisma):

- **User**: id, anonymousId, telegramUserId, telegramUserData, isBlackTheme, Session[], Dashboard[]
- **Session**: id, userId, createdAt, deletedAt
- **Dashboard**: id, name, deviceId, userId, isBlackTheme, Widget[]
- **Widget**: id, options (JSON), state (JSON), позиционирование сетки, цвета, dashboardId
- **WidgetLog**: id, oldOptions, newOptions, oldState, newState, widgetId

## Текущий статус реализации

### Завершенные компоненты
1. Инфраструктура проекта (AnalogJS, Ionic, Prisma)
2. Реализация схемы базы данных
3. Система аутентификации через Telegram
4. Базовый веб-интерфейс (вход, список дашбордов, просмотр дашборда, привязка устройства)
5. Генерация QR-кода для привязки устройства
6. Конфигурация развертывания Vercel
7. Рабочий процесс GitHub Actions для сборки мобильных приложений

### Ожидающие реализации компоненты
1. Регистрация по email/password
2. Анонимный режим с localStorage
3. Функциональность перепривязки пользователей
4. Полные операции CRUD для дашбордов
5. Операции CRUD для виджетов
6. Частичная реализация виджета отслеживания привычек
7. Сканирование QR-кода в мобильном приложении
8. Компоненты отображения виджетов на мобильном устройстве
9. Обновления виджетов в реальном времени
10. Управление состоянием виджетов
11. Офлайн-кэширование для мобильного приложения
12. Сбор метрик использования

## План разработки

См. подробное отслеживание задач в:
- [PROJECT_TASKS_RU.md](./PROJECT_TASKS_RU.md) (Русский)
- [PROJECT_TASKS.md](./PROJECT_TASKS.md) (Английский)

### Спринт 1 (2025-11-12 – 2025-11-17)
Фокус: Завершение основного функционала для базового управления дашбордами

### Спринт 2 (2025-11-18 – 2025-11-24)
Фокус: Реализация мобильного приложения и полной интеграции

## Ключевые файлы и каталоги

### Веб-приложение
- [schema.prisma](./web/prisma/schema.prisma) - Схема базы данных
- [vite.config.ts](./web/vite.config.ts) - Конфигурация Vite
- [package.json](./web/package.json) - Зависимости и скрипты
- [src/app/](./web/src/app/) - Фронтенд компоненты
- [src/server/](./web/src/server/) - Бэкенд маршруты и логика
- [src/server/trpc/routers/](./web/src/server/trpc/routers/) - Конечные точки tRPC API

### Мобильное приложение
- [capacitor.config.ts](./mobile/capacitor.config.ts) - Конфигурация Capacitor
- [ionic.config.json](./mobile/ionic.config.json) - Конфигурация Ionic
- [package.json](./mobile/package.json) - Зависимости и скрипты
- [src/app/](./mobile/src/app/) - Исходный код приложения

## Конечные точки API

### Маршруты tRPC
- `/users` - Управление пользователями
- `/telegram` - Аутентификация через Telegram
- `/auth` - Операции аутентификации
- `/dashboards` - Операции с дашбордами
- `/widgets` - Операции с виджетами

См. реализацию в [src/server/trpc/routers/](./web/src/server/trpc/routers/)

## Система аутентификации

Веб-приложение использует аутентификацию через Telegram с:
- Методом перенаправления
- Проверкой хэша на стороне сервера
- Туннелированием через tuna.am для локальной разработки

См. [Интеграция аутентификации через Telegram](./web/README_RU.md#аутентификация-через-telegram) для подробностей.

## Среда разработки

### Предварительные требования
- Node.js 22.x
- База данных PostgreSQL (рекомендуется Neon)
- Telegram бот для аутентификации (опционально для локальной разработки)

### Переменные окружения
```
MY_DASHBOARD_DATABASE_POSTGRES_URL=postgresql_connection_string
```

### Запуск приложений

#### Веб-приложение
```bash
cd web
npm install
npm start
```

#### Мобильное приложение
```bash
cd mobile
npm install
ionic serve
```

## Развертывание

### Веб-приложение
- Платформа: Vercel
- База данных: Neon PostgreSQL (нативная интеграция)
- URL: https://site15-my-dashboard.vercel.app

### Мобильное приложение
- Платформа: Android APK
- Сборка: Рабочий процесс GitHub Actions
- Дистрибуция: Ручная

## Подробная документация

Для получения исчерпывающей информации о проекте обратитесь к:
- [PROJECT_OVERVIEW_RU.md](./PROJECT_OVERVIEW_RU.md) - Техническое задание и план реализации
- [TECHNICAL_DOCUMENTATION.md](./web/TECHNICAL_DOCUMENTATION.md) - Подробная техническая документация
- [README_RU.md](./README_RU.md) - Документация корневого проекта
- [web/README_RU.md](./web/README_RU.md) - Документация веб-приложения
- [mobile/README_RU.md](./mobile/README_RU.md) - Документация мобильного приложения

## Устранение неполадок

Распространенные проблемы и решения:
1. "Bot domain invalid" - Настройка домена бота через BotFather
2. "Blocked request" - Добавление домена в allowedHosts в vite.config.ts

См. [Устранение неполадок](./web/README_RU.md#устранение-неполадок) для подробных решений.