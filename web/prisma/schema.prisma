// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client1 {
  provider   = "prisma-client"
  output     = "../src/app/generated/prisma"
  engineType = "client"
}

generator client2 {
  provider   = "prisma-client"
  output     = "../src/server/generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
  url      = env("MY_DASHBOARD_DATABASE_POSTGRES_URL")
}

model User {
  id               String      @id(map: "PK_USER") @default(uuid()) @db.Uuid
  anonymousId      String?
  telegramUserId   String?
  telegramUserData Json?
  isBlackTheme     Boolean?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @default(now())
  Session          Session[]
  Dashboard        Dashboard[]

  @@unique([telegramUserId], map: "UQ_USER")
}

model Session {
  id        String    @id(map: "PK_SESSION") @default(uuid()) @db.Uuid
  userId    String    @db.Uuid
  User      User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_SESSION__USER_ID")
  createdAt DateTime  @default(now())
  deletedAt DateTime?

  @@index([userId], map: "IDX_SESSION__USER_ID")
}

model Dashboard {
  id           String    @id(map: "PK_DASHBOARD") @default(uuid()) @db.Uuid
  name         String
  deviceId     String?
  userId       String    @db.Uuid
  isBlackTheme Boolean?
  isActive     Boolean?
  User         User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_DASHBOARD__USER_ID")
  Widget       Widget[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now())
  deletedAt    DateTime?
  qrCodes      QrCode[]  @relation(map: "FK_WIDGET__DASHBOARD_ID")

  @@unique([userId, name], map: "UQ_DASHBOARD__USER_ID_NAME")
  @@unique([deviceId], map: "UQ_DASHBOARD__DEVICE_ID")
  @@index([userId], map: "IDX_DASHBOARD__USER_ID")
}

model QrCode {
  id   String @id(map: "PK_QRCODE") @default(uuid()) @db.Uuid
  code String

  dashboardId String    @db.Uuid
  Dashboard   Dashboard @relation(fields: [dashboardId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_QRCODE__DASHBOARD_ID")

  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now())
  deletedAt DateTime?

  @@unique([dashboardId, code], map: "UQ_QRCODE__CODE")
  @@index([dashboardId], map: "IDX_QRCODE__DASHBOARD_ID")
}

model Widget {
  id          String @id(map: "PK_WIDGET") @default(uuid()) @db.Uuid
  type        String
  options     Json?
  state       Json?
  columnIndex Int?
  rowIndex    Int?
  columnCount Int?
  rowCount    Int?

  isBlackTheme    Boolean?
  isActive        Boolean?
  backgroundColor String?
  primaryColor    String?
  positiveColor   String?
  negativeColor   String?
  // contrastMultiplier       Float
  // textSaturationMultiplier Float

  dashboardId String      @db.Uuid
  Dashboard   Dashboard   @relation(fields: [dashboardId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_WIDGET__DASHBOARD_ID")
  WidgetLog   WidgetLog[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now())
  deletedAt DateTime?

  @@index([dashboardId], map: "IDX_WIDGET__DASHBOARD_ID")
}

model WidgetLog {
  id         String @id(map: "PK_WIDGET_LOG") @default(uuid()) @db.Uuid
  oldOptions Json?
  newOptions Json?
  oldState   Json?
  newState   Json?

  widgetId  String    @db.Uuid
  Widget    Widget    @relation(fields: [widgetId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_WIDGET_LOG__WIDGET_ID")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now())
  deletedAt DateTime?

  @@index([widgetId], map: "IDX_WIDGET_LOG__WIDGET_ID")
}
